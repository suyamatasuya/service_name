<div class="modal fade" id="signUpModal" tabindex="-1" role="dialog" aria-labelledby="signUpModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="signUpModalLabel">新規登録</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <!-- エラーメッセージの表示 -->
        <div id="error_explanation" class="alert alert-danger" style="display:none;"></div>

        <%= form_with model: @user, url: users_path, remote: true do |f| %>
          <div class="form-group">
            <%= f.label :email %>
            <%= f.email_field :email, class: 'form-control' %>
          </div>
          <div class="form-group">
            <%= f.label :name %>
            <%= f.text_field :name, class: 'form-control' %>
          </div>
          <div class="form-group">
            <%= f.label :password %>
            <%= f.password_field :password, class: 'form-control' %>
          </div>
          <div class="form-group">
            <%= f.label :password_confirmation %>
            <%= f.password_field :password_confirmation, class: 'form-control' %>
          </div>
          <%= f.submit '新規登録', class: 'btn btn-primary mt-3' %>
        <% end %>
      </div>
    </div>
  </div>
</div>

<script>
  $(document).on('ajax:success', '#new_user', function(e) {
    // 成功したらモーダルを閉じる
    $('#signUpModal').modal('hide');
  });

  $(document).on('ajax:error', '#new_user', function(event) {
    var errors = event.detail[0];
    var errorMessages = '';

    // エラーメッセージの生成
    $.each(errors, function(field, messages) {
      errorMessages += '<li>' + field + ': ' + messages.join(', ') + '</li>';
    });

    // エラーメッセージの表示
    $('#error_explanation')
      .html('<ul>' + errorMessages + '</ul>')
      .show();
  });
</script>
