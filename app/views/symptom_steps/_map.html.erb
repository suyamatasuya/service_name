<div id="map"></div>

<script>
  var map;
  var infowindow;

  function initMap() {
    // Use HTML5 geolocation to get the user's current position
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(function(position) {
        var currentLocation = {
          lat: position.coords.latitude,
          lng: position.coords.longitude
        };

        map = new google.maps.Map(document.getElementById('map'), {
          center: currentLocation,
          zoom: 15
        });

        var request = {
          location: currentLocation,
          radius: '5000',  // 5km
          type: ['doctor']  // Assuming this will find orthopedics, modify as needed
        };

        infowindow = new google.maps.InfoWindow();
        var service = new google.maps.places.PlacesService(map);
        service.nearbySearch(request, callback);
      }, function(error) {
        // 現在位置の取得に失敗した時の処理
        console.error('Error occurred in geolocation: ' + error.message);
      });
    } else {
      // Browser doesn't support Geolocation
      console.log("Geolocation is not supported by this browser.");
    }
  }

  function callback(results, status) {
    if (status === google.maps.places.PlacesServiceStatus.OK) {
      for (var i = 0; i < results.length; i++) {
        createMarker(results[i]);
      }
    }
  }

  function createMarker(place) {
    var placeLoc = place.geometry.location;
    var marker = new google.maps.Marker({
      map: map,
      position: place.geometry.location
    });

    google.maps.event.addListener(marker, 'click', function() {
      infowindow.setContent(place.name);
      infowindow.open(map, this);
    });
  }
</script>

<style>
  /* Optional: Makes the sample page fill the window. */
  #map {
    height: 100%;
  }
</style>
