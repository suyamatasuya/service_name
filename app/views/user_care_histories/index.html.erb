<head>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

    <style>
      body {
        height: 0px;
        background-color: #f5f1e8;
        font-family: Arial, sans-serif; /* Use Arial or a similar sans-serif font */
        font-size: 16px; /* Font size */
        line-height: 1.5; /* Line height */
      }
      .container {
        max-width: 90%; /* Make the container 80% of full-width */
        margin: 0 auto; /* Center the container */
        padding: 10px; /* Add padding to the container */
      }
      h1 {
        font-size: 28px; /* Larger heading font size */
        text-align: center; /* Center the heading */
        margin-bottom: 30px; /* Add space below the heading */
      }
      .modal-lg {
        max-width: 80%; /* Large modal */
      }
      .modal-content {
        overflow: auto; /* Add scrollbar if necessary */
        height: 80vh; /* 80% of the viewport height */
      }
      .table td, .table th {
        padding: 10px; /* Add padding to table cells */
        vertical-align: top; /* Align cell contents to the top */
      }
      .modal-body {
        font-size: 18px; /* Larger modal body font size */
        white-space: pre-wrap; /* Respect newline characters in text */
        text-align: justify; /* Justify text for better readability */
      }
    </style>
  </head>
  <body>
    <div class="container py-5">
      <h1 class="mb-5 text-center">あなたの問診結果</h1>

      <table class="table table-striped">
        <thead>
          <tr>
            <th>問診結果</th>
            <th>ケア内容</th>
            <th>ケア方法提案日</th>
            <th>症状</th>
            <th>関連動画</th>
          </tr>
        </thead>
        <tbody>
          <% @user_care_histories.each do |history| %>
            <tr>
              <td><%= history.care_method.name %></td>
              <td>
                <!-- Trigger modal with a button -->
                <button type="button" class="btn btn-link" data-toggle="modal" data-target="#descModal<%= history.id %>">詳細</button>

                <!-- Modal -->
                <div class="modal fade" id="descModal<%= history.id %>" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                  <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel"><%= history.care_method.name %> </h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">&times;</span>
                        </button>
                      </div>
                      <div class="modal-body">
                        <%= history.care_method.description.split(' ').map { |s| "<p>#{s.strip}</p>" }.join.html_safe %>
                      </div>
                    </div>
                  </div>
                </div>
              </td>
              <td><%= history.care_received_date %></td>
              <td><%= history.symptom.pain_type %> pain in <%= history.symptom.pain_location %></td>
              <td>
                <!-- Only show the Details button if there are video links -->
                <% if history.care_method.video_links.present? %>
                  <!-- Trigger modal with a button -->
                  <button type="button" class="btn btn-info" data-toggle="modal" data-target="#detailModal<%= history.id %>">動画一覧</button>

                  <!-- Modal -->
                  <div class="modal fade" id="detailModal<%= history.id %>" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg" role="document">
                      <div class="modal-content">
                        <div class="modal-header">
                          <h5 class="modal-title" id="exampleModalLabel"><%= history.care_method.name %></h5>
                          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                          </button>
                        </div>
                        <div class="modal-body">
                          <!-- Video links -->
                          <% history.care_method.video_links.each_with_index do |video, index| %>
                            <div>
                              <strong><%= history.care_method.video_titles[index] %></strong><br>
                              <a href="<%= video %>" target="_blank" rel="noopener noreferrer">動画を見る</a>
                            </div>
                          <% end %>
                        </div>
                      </div>
                    </div>
                  </div>
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
</body>
